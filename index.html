<!DOCTYPE html>
<html>
<body>
<script>
    const KEY = 'dim_bright_cart';
    window.addEventListener("message", function(event) {
        let cart = JSON.parse(localStorage.getItem(KEY) || '[]');
        if (event.data.type === "ADD") {
            const p = event.data.product;
            const existing = cart.find(i => i.id === p.id);
            if (existing) { existing.qty += 1; } else { cart.push(p); }
            localStorage.setItem(KEY, JSON.stringify(cart));
        }
        if (event.data.type === "CLEAR") { localStorage.removeItem(KEY); }
        if (event.data.type === "GET") {
            window.parent.postMessage({type: "CART_DATA", cart: cart}, "*");
        }
    });
</script>
</body>
</html>

